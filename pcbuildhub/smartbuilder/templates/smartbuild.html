{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Smart Builder (Testing)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #1a1a1a;
            color: white;
            padding: 40px;
        }
        .card-option {
            cursor: pointer;
            background-color: #2c2c3c;
            border: 1px solid #444;
        }
        .card-option.active {
            background-color: #6c5ce7;
            color: white;
            border-color: #6c5ce7;
        }
        .section { display: none; }
        .section.active { display: block; }
    </style>
</head>
<body>
<div class="container">
    <h1 class="mb-5 text-center">Smart Builder</h1>

    <form method="post" action="{% url 'smart_builder_submit' %}">
        {% csrf_token %}
        <input type="hidden" name="use_case" id="input-use-case">
        <input type="hidden" name="resolution" id="input-resolution">
        <input type="hidden" name="framerate" id="input-framerate">
        <input type="hidden" name="editing_software" id="input-editing_software">
        <input type="hidden" name="dev_type" id="input-dev_type">
        <input type="hidden" name="budget" id="input-budget" value="2000">

        <h4>1. Select Use Case</h4>
        <div class="row my-3">
            {% for opt in use_cases %}
            <div class="col">
                <div class="card card-option text-center p-3" data-type="use-case" role="button" tabindex="0" onclick="selectUseCase('{{ opt }}', event)">{{ opt }}</div>
            </div>
            {% endfor %}
        </div>

        <div id="section-gaming" class="section">
            <h4>Resolution</h4>
            <div class="row my-3">
                {% for res in gaming_resolutions %}
                <div class="col"><div class="card card-option text-center p-3" data-type="resolution" role="button" tabindex="0" onclick="selectOption('resolution', '{{ res }}', event)">{{ res }}</div></div>
                {% endfor %}
            </div>
            <h4>Framerate</h4>
            <div class="row my-3">
                {% for fps in gaming_framerates %}
                <div class="col"><div class="card card-option text-center p-3" data-type="framerate" role="button" tabindex="0" onclick="selectOption('framerate', '{{ fps }}', event)">{{ fps }} fps</div></div>
                {% endfor %}
            </div>
        </div>

        <div id="section-editing" class="section">
            <h4>Editing Resolution</h4>
            <div class="row my-3">
                {% for res in editing_resolutions %}
                <div class="col"><div class="card card-option text-center p-3" data-type="resolution" role="button" tabindex="0" onclick="selectOption('resolution', '{{ res }}', event)">{{ res }}</div></div>
                {% endfor %}
            </div>
            <h4>Editing Software</h4>
            <div class="row my-3">
                {% for sw in editing_software %}
                <div class="col"><div class="card card-option text-center p-3" data-type="editing_software" role="button" tabindex="0" onclick="selectOption('editing_software', '{{ sw }}', event)">{{ sw }}</div></div>
                {% endfor %}
            </div>
        </div>

        <div id="section-dev" class="section">
            <h4>Type of Development</h4>
            <div class="row my-3">
                {% for dev in dev_types %}
                <div class="col"><div class="card card-option text-center p-3" data-type="dev_type" role="button" tabindex="0" onclick="selectOption('dev_type', '{{ dev }}', event)">{{ dev }}</div></div>
                {% endfor %}
            </div>
        </div>

        <h4>Budget</h4>
        <div class="row my-3" id="budget-section">
            {% for case, budgets in budgets_by_use_case.items %}
                <div class="budget-group" id="budget-{{ case|lower }}" style="display: none;">
                    {% for b in budgets %}
                    <div class="col-auto">
                        <button class="btn btn-outline-primary"
                                type="button"
                                onclick="selectBudget('{{ b.value }}', event)"
                                data-type="budget">
                            {{ b.label }}
                        </button>
                    </div>
                    {% endfor %}
                </div>
            {% endfor %}
        </div>

        <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary btn-lg">Create the PC</button>
        </div>
    </form>
</div>

<script>
    function selectUseCase(value, e) {
        const input = document.getElementById("input-use-case");
        if (!input) return console.error("Missing input-use-case element");
    
        let use_case_value = value.toLowerCase().replace(/\s+/g, "-");
        if (use_case_value === "video-editing") use_case_value = "editing";
        if (use_case_value === "development") use_case_value = "dev";
        
        input.value = use_case_value;
    
        document.querySelectorAll("[data-type='use-case']").forEach(el => el.classList.remove("active"));
        e.currentTarget.classList.add("active");
    
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        const section = document.getElementById("section-" + use_case_value);
        if (section) section.classList.add("active");

        document.querySelectorAll('.budget-group').forEach(group => group.style.display = "none");
        const budgetGroup = document.getElementById("budget-" + use_case_value);
        if (budgetGroup) budgetGroup.style.display = "flex";
    
        console.log("[USE CASE]", use_case_value);
    }    

    function selectOption(type, value, e) {
        const input = document.getElementById("input-" + type);
        if (!input) return console.error("Missing input-" + type);
        input.value = value;
        document.querySelectorAll(`[data-type='${type}']`).forEach(el => el.classList.remove("active"));
        e.currentTarget.classList.add("active");
        console.log(`[${type.toUpperCase()}]`, value);
    }

    function selectBudget(value, e) {
        const input = document.getElementById("input-budget");
        if (!input) return console.error("Missing input-budget");
        input.value = value;
        document.querySelectorAll("[data-type='budget']").forEach(el => el.classList.remove("active"));
        e.currentTarget.classList.add("active");
        console.log("[BUDGET]", value);
    }
</script>
</body>
</html>